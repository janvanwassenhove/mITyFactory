# Python FastAPI Template
# This template provides a production-ready FastAPI application
# with full IaC support for deployment to AWS, Azure, or GCP.

id: python-fastapi
name: Python FastAPI
description: A modern, fast Python web API using FastAPI and uvicorn
version: "1.0.0"
author: mITyFactory
category: backend
status: production

# Language/Runtime Configuration
runtime:
  language: python
  version: "3.12"
  package_manager: pip

# Container Configuration
container:
  image: python
  tag: "3.12-slim"
  build_command:
    - pip
    - install
    - -e
    - "."
  test_command:
    - pytest
  run_command:
    - uvicorn
    - src.main:app
    - --host
    - "0.0.0.0"
    - --port
    - "8000"
  ports:
    - 8000
  workdir: /app

# Build/Test/Lint Commands
commands:
  install:
    - pip install -e ".[dev]"
  build:
    - pip install -e .
  test:
    - pytest
  lint:
    - ruff check .
  format:
    - ruff format .
  run:
    - uvicorn src.main:app --reload

# DevContainer Configuration
devcontainer:
  image: mcr.microsoft.com/devcontainers/python:3.12
  features:
    ghcr.io/devcontainers/features/docker-in-docker:2: {}
    ghcr.io/devcontainers-contrib/features/terraform-asdf:2: {}
  extensions:
    - ms-python.python
    - ms-python.vscode-pylance
    - charliermarsh.ruff
    - redhat.vscode-yaml
    - hashicorp.terraform
  post_create:
    - pip install -e ".[dev]"
  ports:
    - 8000

# IaC Support Configuration
iac:
  enabled: true
  providers:
    - provider: terraform
      clouds:
        - aws
        - azure
        - gcp
      base_module: iac/terraform/base
  outputs:
    - name: container_image
      description: Container image name for deployment
      type: string
    - name: container_tag
      description: Container image tag
      type: string
      default: latest
    - name: container_port
      description: Port the application listens on
      type: number
      default: "8000"
    - name: health_check_path
      description: Health check endpoint path
      type: string
      default: /health
    - name: api_prefix
      description: API route prefix
      type: string
      default: /api/v1

# Template Variables
variables:
  - name: project_name
    description: Name of the project (used for package name and directories)
    required: true
    pattern: "^[a-z][a-z0-9_-]*$"
  - name: description
    description: Project description
    default: A FastAPI application
  - name: python_version
    description: Python version to use
    default: "3.12"
  - name: author_name
    description: Author name
    default: mITyFactory
  - name: author_email
    description: Author email
    default: factory@example.com

# Files to render (variable substitution)
files_to_render:
  - pyproject.toml
  - README.md
  - Dockerfile
  - src/main.py
  - .devcontainer/devcontainer.json

# Post-create commands
post_create_commands:
  - pip install -e ".[dev]"
  - ruff check . || true

# Tags for filtering
tags:
  - python
  - fastapi
  - rest
  - api
  - backend
  - containerized
  - terraform
