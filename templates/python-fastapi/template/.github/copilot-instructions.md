# GitHub Copilot Instructions for {{app_name}}

## Project Overview

{{app_name}} is a Python FastAPI application generated by mITyFactory.

## Tech Stack

- **Backend**: Python 3.12
- **Framework**: FastAPI
- **Server**: Uvicorn (ASGI)
- **Testing**: pytest
- **Linting**: Ruff

## Project Structure

```
{{app_name}}/
├── src/
│   ├── main.py          # Application entry point
│   ├── routes/          # API route handlers
│   ├── models/          # Pydantic models
│   ├── services/        # Business logic
│   └── utils/           # Utility functions
├── tests/
│   ├── unit/            # Unit tests
│   └── integration/     # Integration tests
├── docs/
│   └── architecture/    # Architecture documentation
├── .specify/            # Spec Kit (constitution, principles, features)
└── .github/             # GitHub configuration
```

---

## Code Style Rules

### Python Conventions

- Follow PEP 8 style guide
- Use type hints for all function signatures
- Use Pydantic models for data validation
- Prefer async/await for I/O operations

### FastAPI Patterns

```python
# Route handlers
@router.get("/items/{item_id}", response_model=ItemResponse)
async def get_item(item_id: int, db: Session = Depends(get_db)) -> ItemResponse:
    """Get an item by ID."""
    ...

# Dependency injection
def get_db() -> Generator[Session, None, None]:
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

### Error Handling

```python
from fastapi import HTTPException, status

# Always use appropriate HTTP status codes
raise HTTPException(
    status_code=status.HTTP_404_NOT_FOUND,
    detail="Item not found"
)
```

---

## Testing Requirements

### Unit Tests

- Test all service functions in isolation
- Mock external dependencies
- Target 80%+ coverage

### Integration Tests

- Test API endpoints with TestClient
- Verify request/response contracts
- Test authentication flows

### Running Tests

```bash
# All tests
pytest

# With coverage
pytest --cov=src --cov-report=html

# Specific module
pytest tests/unit/test_services.py
```

---

## API Design Guidelines

1. **RESTful conventions**: Use proper HTTP methods (GET, POST, PUT, DELETE)
2. **Versioning**: Prefix routes with `/api/v1/`
3. **Response format**: Use consistent JSON structure
4. **Pagination**: Use limit/offset for list endpoints
5. **Validation**: Use Pydantic for request validation

---

## Factory Alignment

This application follows mITyFactory principles:

1. **Spec-driven**: All features defined in `.specify/features/`
2. **Container-first**: Runs in Docker containers
3. **Deterministic**: Reproducible builds
4. **Quality gates**: Tests, lints, and security checks

---

## DO ✓

- Use async/await for database and HTTP operations
- Write tests for new features before implementation
- Follow the spec in `.specify/` for feature definitions
- Use environment variables for configuration
- Document API endpoints with OpenAPI docstrings

## DON'T ✗

- Hardcode configuration values
- Skip error handling
- Commit secrets to the repository
- Write synchronous blocking code in handlers
- Skip type hints
