# GitHub Copilot Instructions for {{app_name}}

## Project Overview

{{app_name}} is an ASP.NET Core Web API generated by mITyFactory.

## Tech Stack

- **Backend**: C# 12 / .NET 8
- **Framework**: ASP.NET Core with Minimal APIs
- **Testing**: xUnit, FluentAssertions
- **Database**: Entity Framework Core

## Project Structure

```
{{app_name}}/
├── Api.csproj
├── Program.cs                      # Application entry & endpoint definitions
├── Endpoints/                      # Endpoint group classes
├── Services/                       # Business logic
├── Data/                          # DbContext and repositories
├── Models/                        # Entity and DTO classes
├── Properties/
│   └── launchSettings.json
├── appsettings.json
├── .specify/                       # Spec Kit
└── .github/                        # GitHub configuration
```

---

## Code Style Rules

### Minimal API Patterns

```csharp
// Program.cs
var builder = WebApplication.CreateBuilder(args);
builder.Services.AddScoped<IItemService, ItemService>();

var app = builder.Build();

app.MapGet("/api/v1/items/{id}", async (int id, IItemService service) =>
    await service.GetByIdAsync(id) is Item item
        ? Results.Ok(item)
        : Results.NotFound());

app.Run();
```

### Service Pattern

```csharp
public interface IItemService
{
    Task<Item?> GetByIdAsync(int id);
}

public class ItemService : IItemService
{
    private readonly AppDbContext _context;
    
    public ItemService(AppDbContext context) => _context = context;
    
    public async Task<Item?> GetByIdAsync(int id) =>
        await _context.Items.FindAsync(id);
}
```

---

## Testing Requirements

### Unit Tests
- Test all service methods
- Use xUnit and Moq
- Target 80%+ coverage

### Integration Tests
- Use `WebApplicationFactory<Program>`
- Test endpoint behavior

```csharp
public class ItemEndpointsTests : IClassFixture<WebApplicationFactory<Program>>
{
    private readonly HttpClient _client;

    public ItemEndpointsTests(WebApplicationFactory<Program> factory) =>
        _client = factory.CreateClient();

    [Fact]
    public async Task GetItem_ReturnsOk()
    {
        var response = await _client.GetAsync("/api/v1/items/1");
        response.StatusCode.Should().Be(HttpStatusCode.OK);
    }
}
```

---

## Factory Alignment

This application follows mITyFactory principles:

1. **Spec-driven**: All features defined in `.specify/features/`
2. **Container-first**: Runs in Docker containers
3. **Deterministic**: Reproducible builds
4. **Quality gates**: Tests, analyzers, and security checks

---

## DO ✓

- Use dependency injection
- Write tests for new features
- Follow the spec in `.specify/`
- Use `appsettings.json` for configuration
- Use async/await for I/O operations

## DON'T ✗

- Use static service locators
- Hardcode configuration values
- Commit secrets to the repository
- Skip input validation
- Block async calls with `.Result` or `.Wait()`
